# CLI Tools

Command-line tools for validation and compliance checking.

## protocol-zero.sh

Protocol Zero Enforcement: Automated attribution scanning.

### Location

```
scripts/protocol-zero.sh
```

### Purpose

Scans codebase and commit metadata for forbidden attribution markers. This script enforces the Protocol Zero policy defined in CLAUDE.md by detecting phrases that indicate non-human authorship.

### Usage

```bash
# Scan entire codebase
./scripts/protocol-zero.sh

# Scan specific directory
./scripts/protocol-zero.sh --dir <path>

# Validate commit message
./scripts/protocol-zero.sh --commit-msg "message"

# Validate commit message from file
./scripts/protocol-zero.sh --commit-msg-file <path>

# Show help
./scripts/protocol-zero.sh --help
```

### Modes

#### Codebase Scan (Default)

Scans all files in the repository for prohibited patterns.

```bash
./scripts/protocol-zero.sh
```

**Output on success:**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Protocol Zero: Codebase Attribution Scan
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[INFO] Scanning directory: .
[INFO] Excluded directories: node_modules .git .next ...
[INFO] Excluded files: CLAUDE.md protocol-zero.sh ...

[INFO] Files scanned: ~52

[PASS] Protocol Zero: No attribution artifacts detected.
```

**Output on violation:**

```
[FAIL] Protocol Zero Violation Detected!

Violations Found:

  ├─ src/example.py:42
  │  Pattern: generated by claude
  │  Content: # This code was generated by Claude

Action Required: Remove attribution before proceeding.
```

#### Commit Message Validation

Validates a commit message string.

```bash
./scripts/protocol-zero.sh --commit-msg "feat(models): add education schema"
```

#### Commit Message File Validation

Validates a commit message from a file (used by git hooks).

```bash
./scripts/protocol-zero.sh --commit-msg-file .git/COMMIT_EDITMSG
```

### Prohibited Patterns

The script detects these case-insensitive patterns:

| Category       | Patterns                                                                                                     |
| -------------- | ------------------------------------------------------------------------------------------------------------ |
| Attribution    | "generated by claude", "generated by ai", "generated by copilot", "generated by gpt", "generated by chatgpt" |
| Assistance     | "ai assisted", "ai-assisted", "ai generated", "ai-generated"                                                 |
| Creation       | "created with ai", "created by ai", "written by ai", "written by claude"                                     |
| Co-authorship  | "co-authored-by:.*claude", "co-authored-by:.*copilot", "co-authored-by:.\*ai"                                |
| Conversational | "i hope this helps", "as requested", "here is the code"                                                      |
| Self-reference | "as an ai", "as a language model", "i'm an ai", "i am an ai"                                                 |

### Excluded Paths

The script excludes these directories from scanning:

- `node_modules`
- `.git`
- `.next`
- `.pnpm`
- `dist`
- `build`
- `.turbo`
- `.venv`
- `out`
- `drafts`
- `__pycache__`

The script excludes these files:

- `CLAUDE.md`
- `protocol-zero.sh`
- `design_doc.md`
- `claudehome.md`
- `pyproject.toml`
- `README.md`

The script excludes these path patterns:

- `docs/epics/`
- `docs/design`
- `.github/`
- `.claude/`

### Exit Codes

| Code | Meaning                |
| ---- | ---------------------- |
| 0    | No violations detected |
| 1    | Violation(s) detected  |

### Integration with Git Hooks

Add to `.git/hooks/commit-msg`:

```bash
#!/usr/bin/env bash
./scripts/protocol-zero.sh --commit-msg-file "$1"
```

### Integration with CI

```yaml
# GitHub Actions example
- name: Protocol Zero Check
  run: ./scripts/protocol-zero.sh
```

## YAML Validation

Validate YAML files against schemas using Python.

### Usage

```python
from scripts.rvs.loader import load_yaml_strict
from scripts.rvs.models import Profile, Education, Skills

# Validate profile
profile = load_yaml_strict("data/profile.yaml", Profile)

# Validate education
education = load_yaml_strict("data/education.yaml", Education)

# Validate skills
skills = load_yaml_strict("data/skills.yaml", Skills)
```

### Batch Validation Script

Create a validation script:

```python
#!/usr/bin/env python3
"""Validate all YAML files in the repository."""

import sys
from pathlib import Path

from scripts.rvs.loader import load_yaml_strict, YAMLLoadError, YAMLValidationError
from scripts.rvs.models import (
    Profile,
    Education,
    Skills,
    ExperienceFile,
    ProjectFile,
)

VALIDATIONS = [
    ("data/profile.yaml", Profile),
    ("data/education.yaml", Education),
    ("data/skills.yaml", Skills),
]

def main() -> int:
    errors = []

    # Validate atomic facts
    for path, model in VALIDATIONS:
        try:
            load_yaml_strict(path, model)
            print(f"[PASS] {path}")
        except (YAMLLoadError, YAMLValidationError) as e:
            print(f"[FAIL] {path}: {e}")
            errors.append(path)

    # Validate experience files
    for path in Path("content/experience").glob("*.yaml"):
        if path.name == ".gitkeep":
            continue
        try:
            load_yaml_strict(path, ExperienceFile)
            print(f"[PASS] {path}")
        except (YAMLLoadError, YAMLValidationError) as e:
            print(f"[FAIL] {path}: {e}")
            errors.append(str(path))

    # Validate project files
    for path in Path("content/projects").glob("*.yaml"):
        if path.name == ".gitkeep":
            continue
        try:
            load_yaml_strict(path, ProjectFile)
            print(f"[PASS] {path}")
        except (YAMLLoadError, YAMLValidationError) as e:
            print(f"[FAIL] {path}: {e}")
            errors.append(str(path))

    if errors:
        print(f"\n{len(errors)} file(s) failed validation")
        return 1

    print("\nAll files validated successfully")
    return 0

if __name__ == "__main__":
    sys.exit(main())
```

## yamllint

Lint YAML files for formatting issues.

### Usage

```bash
# Lint all YAML directories
.venv/bin/yamllint data/ content/ config/

# Lint specific file
.venv/bin/yamllint data/profile.yaml
```

### Configuration

Configuration is in `.yamllint.yaml`:

```yaml
extends: default

rules:
  line-length:
    max: 120
  document-start: disable
  truthy:
    allowed-values: ["true", "false", "Present"]
```

## pytest

Run the test suite.

### Usage

```bash
# Run all tests
.venv/bin/python -m pytest tests/ -v

# Run with coverage
.venv/bin/python -m pytest tests/ --cov=scripts.rvs --cov-report=term-missing

# Run specific test class
.venv/bin/python -m pytest tests/test_schemas.py::TestResumeID -v

# Run specific test
.venv/bin/python -m pytest tests/test_schemas.py::TestResumeID::test_valid_lowercase_alphanumeric -v
```

### Configuration

Configuration is in `pyproject.toml`:

```toml
[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
```
